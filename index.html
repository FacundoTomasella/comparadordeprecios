<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ffffff">
    
    <!-- SEO -->
    <title>TradingChango | Trade√° los Precios, Maximiz√° el Carrito</title>
    <meta name="description" content="Comparador de precios de supermercados en tiempo real.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõí</text></svg>">
    
    <!-- No Cach√© -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <!-- Fuentes & Iconos -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- LIBRER√çA PARA EL GR√ÅFICO (REQUERIDO) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            /* MODO D√çA (Default) */
            --bg-app: #ffffff;
            --bg-card: #f9f9f9;
            --bg-nav: #ffffff;
            --text-main: #131722;
            --text-muted: #787b86;
            --border: #e0e3eb;
            
            --accent: #2962ff; 
            
            /* L√ìGICA PRECIOS */
            --color-good: #00a650;   /* Verde */
            --color-bad: #f23645;    /* Rojo */
            --star-gold: #f2a900;
        }

        body.dark-mode {
            /* MODO OSCURO */
            --bg-app: #000000;
            --bg-card: #121212;
            --bg-nav: #121212;
            --text-main: #ffffff;
            --text-muted: #888888;
            --border: #2a2a2a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: var(--bg-app); color: var(--text-main); 
            font-family: '-apple-system', 'BlinkMacSystemFont', 'Inter', sans-serif; 
            padding-bottom: 90px; 
            transition: background 0.3s, color 0.3s;
            display: flex; flex-direction: column; align-items: center;
        }

        .app-container {
            width: 100%; max-width: 600px; min-height: 100vh;
            background: var(--bg-app);
            border-left: 1px solid var(--border);
            border-right: 1px solid var(--border);
            position: relative;
        }

        /* HEADER */
        header {
            position: sticky; top: 0; z-index: 50;
            background: var(--bg-app);
            border-bottom: 1px solid var(--border); padding: 15px 20px;
        }

        .top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        .logo-link { text-decoration: none; color: inherit; }
        
        /* LOGO ESTILO IMAGEN (Carrito + Flecha) */
        .logo { 
            font-weight: 800; font-size: 20px; letter-spacing: -0.5px; 
            display: flex; align-items: center; gap: 8px; color: var(--text-main);
        }
        .logo-icon-wrapper {
            position: relative; 
            display: flex; align-items: center; justify-content: center;
            height: 24px; width: 30px;
        }
        .logo-icon-wrapper .fa-cart-shopping {
            font-size: 18px; color: var(--text-main); /* Color del texto */
        }
        .logo-icon-wrapper .fa-arrow-trend-up {
            font-size: 12px; color: var(--color-good); /* Flecha verde */
            position: absolute; top: -4px; right: -2px;
            background: var(--bg-app); padding: 1px; border-radius: 50%;
        }
        
        .theme-btn { background: none; border: none; color: var(--text-main); font-size: 20px; cursor: pointer; }

        /* BUSCADOR */
        .search-container { position: relative; }
        #searchInput {
            width: 100%; background: var(--bg-card); 
            border: 1px solid var(--border);
            color: var(--text-main); padding: 12px 12px 12px 42px; border-radius: 8px;
            font-size: 15px; font-family: 'Inter', sans-serif;
            transition: border-color 0.2s;
        }
        #searchInput:focus { border-color: var(--accent); outline: none; }
        .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 16px; }

        /* FILTROS DE TENDENCIA (NUEVO) */
        .trend-filters {
            display: flex; gap: 10px; margin-top: 12px;
        }
        .trend-btn {
            flex: 1;
            padding: 8px; border-radius: 6px; border: 1px solid var(--border);
            background: var(--bg-app); color: var(--text-muted);
            font-size: 13px; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 6px;
            transition: 0.2s;
        }
        .trend-btn:hover { background: var(--bg-card); }
        
        /* Estado Activo Bajando (Verde) */
        .trend-btn.active-down {
            background: rgba(0, 166, 80, 0.1); border-color: var(--color-good); color: var(--color-good);
        }
        /* Estado Activo Subiendo (Rojo) */
        .trend-btn.active-up {
            background: rgba(242, 54, 69, 0.1); border-color: var(--color-bad); color: var(--color-bad);
        }

        /* LISTA TICKERS */
        .ticker-list { padding: 0; }

        .ticker-card {
            border-bottom: 1px solid var(--border);
            cursor: pointer; 
            display: flex; align-items: center; justify-content: space-between;
            padding: 16px 20px; position: relative;
            background: var(--bg-app);
            transition: background 0.2s;
        }
        .ticker-card:active { background: var(--bg-card); }
        
        .ticker-info {
            flex-grow: 1; display: flex; align-items: center; justify-content: space-between; padding-right: 15px;
        }

        .t-left { display: flex; flex-direction: column; gap: 3px; }
        .t-symbol { font-family: 'Roboto Mono', monospace; font-weight: 700; font-size: 16px; letter-spacing: -0.5px; }
        .t-name { font-size: 13px; color: var(--text-muted); max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 500; }
        
        .t-right { text-align: right; }
        .t-price { font-family: 'Roboto Mono', monospace; font-weight: 700; font-size: 16px; }
        
        /* CAMBIOS DE PRECIO */
        .t-change { font-family: 'Roboto Mono'; font-size: 12px; font-weight: 600; padding: 3px 8px; border-radius: 6px; display: inline-block; margin-top: 4px; }
        .trend-up { color: white; background: var(--color-bad); }   
        .trend-down { color: white; background: var(--color-good); } 
        .trend-neutral { color: var(--text-muted); background: rgba(128,128,128,0.1); }

        /* ESTRELLA */
        .fav-btn {
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: flex-end;
            font-size: 20px; color: var(--border); z-index: 10; transition: 0.2s;
        }
        .fav-btn.active { color: var(--star-gold); }

        /* DETALLE (ORDER BOOK) */
        .order-book { 
            display: none; background: var(--bg-card); 
            padding: 5px 20px 20px 20px; border-bottom: 1px solid var(--border); 
        }
        .order-book.open { display: block; animation: slideDown 0.2s ease-out; }
        
        .ob-header { 
            display: flex; justify-content: space-between; 
            font-size: 11px; text-transform: uppercase; color: var(--text-muted); font-weight: 700;
            padding: 12px 0 8px 0; border-bottom: 1px solid var(--border); margin-bottom: 5px;
        }

        .ob-row { 
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 0; border-bottom: 1px dashed var(--border); font-size: 14px; 
        }
        .ob-row:last-child { border: none; }
        
        .ob-store { font-weight: 600; display: flex; align-items: center; gap: 10px; color: var(--text-main); cursor: default; }
        .dot { width: 8px; height: 8px; border-radius: 50%; }
        
        /* PRECIO LINK */
        .price-link { 
            text-decoration: none; color: var(--text-main); 
            font-family: 'Roboto Mono'; font-size: 15px; 
            padding: 6px 10px; border-radius: 6px; 
            background: rgba(0,0,0,0.03); border: 1px solid transparent;
            transition: 0.2s; display: flex; align-items: center; gap: 8px;
        }
        .price-link:hover { background: rgba(41, 98, 255, 0.1); border-color: var(--accent); color: var(--accent); }
        body.dark-mode .price-link:hover { color: #fff; }
        
        .best-val { color: var(--color-good); font-weight: 700; background: rgba(0, 230, 118, 0.1); border-color: rgba(0, 230, 118, 0.3); } 
        
        /* SIN PRECIO TACHADO */
        .no-price { 
            color: var(--text-muted); font-style: italic; opacity: 0.6; 
            text-decoration: line-through; font-size: 12px; pointer-events: none; background: transparent;
        }

        .fa-up-right-from-square { font-size: 11px; opacity: 0.6; }

        /* FOOTER */
        .app-footer {
            text-align: center; padding: 40px 20px; font-size: 12px; 
            color: var(--text-muted); border-top: 1px solid var(--border);
            background: var(--bg-app); margin-bottom: 60px;
        }
        .dev-link { 
            color: var(--accent); text-decoration: none; 
            font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px;
        }
        /* Color footer din√°mico */
        body.dark-mode .dev-link { color: #448aff; } 
        body:not(.dark-mode) .dev-link { color: #d32f2f; }

        /* NAVBAR */
        .bottom-nav {
            position: absolute; bottom: 0; width: 100%; max-width: 600px;
            background: var(--bg-nav); border-top: 1px solid var(--border);
            display: flex; justify-content: space-around; padding: 12px 0;
            z-index: 100; position: fixed; 
        }
        
        .nav-item {
            background: none; border: none; color: var(--text-muted);
            display: flex; flex-direction: column; align-items: center;
            font-size: 10px; gap: 5px; cursor: pointer; width: 25%; font-weight: 500;
        }
        .nav-item i { font-size: 18px; }
        .nav-item.active { color: var(--text-main); font-weight: 800; }
        .nav-item.active i { color: var(--accent); transform: translateY(-2px); transition: 0.2s; }

        .empty-state { text-align: center; padding: 60px 20px; color: var(--text-muted); font-size: 14px; line-height: 1.6; }
        .loader { text-align: center; padding: 50px; color: var(--text-muted); font-family: 'Roboto Mono'; font-size: 12px; letter-spacing: 1px; }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        /* AGREGADO PARA EL GR√ÅFICO SIN TOCAR LO ANTERIOR */
        .ob-selector { display: flex; gap: 15px; border-bottom: 1px solid var(--border); margin-bottom: 10px; }
        .sel-btn { background: none; border: none; color: var(--text-muted); padding: 10px 0; font-size: 11px; font-weight: 700; cursor: pointer; text-transform: uppercase; }
        .sel-btn.active { color: var(--accent); border-bottom: 2px solid var(--accent); }
        .ob-graph-container { display: none; width: 100%; height: 250px; padding: 10px 0; }
        .ob-graph-container.active { display: block; }
        .time-filters { display: flex; justify-content: center; gap: 8px; margin-top: 5px; }
        .time-btn { background: var(--bg-app); border: 1px solid var(--border); color: var(--text-muted); font-size: 10px; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
        .time-btn.active { background: var(--accent); color: white; border-color: var(--accent); }

    </style>
</head>
<body>

    <div class="app-container">
        <header>
            <div class="top-row">
                <a href="http://www.tradingchango.com.ar/" class="logo-link">
                    <div class="logo">
                        <div class="logo-icon-wrapper">
                            <i class="fa-solid fa-cart-shopping"></i>
                            <i class="fa-solid fa-arrow-trend-up"></i>
                        </div>
                        TradingChango
                    </div>
                </a>
                <button class="theme-btn" onclick="toggleTheme()">
                    <i class="fa-solid fa-moon" id="themeIcon"></i>
                </button>
            </div>
            
            <div class="search-container">
                <i class="fa-solid fa-search search-icon"></i>
                <input type="text" id="searchInput" placeholder="BUSCAR PRODUCTO...">
            </div>

            <!-- FILTROS DE TENDENCIA -->
            <div class="trend-filters">
                <button class="trend-btn" id="btnDown" onclick="setTrendFilter('down')">
                    <i class="fa-solid fa-arrow-trend-down"></i> Precios Bajando
                </button>
                <button class="trend-btn" id="btnUp" onclick="setTrendFilter('up')">
                    <i class="fa-solid fa-arrow-trend-up"></i> Precios Subiendo
                </button>
            </div>
        </header>

        <div id="loader">CONECTANDO A MERCADO...</div>

        <div class="ticker-list" id="tickerList"></div>

        <footer class="app-footer">
    Desarrollado por <a href="https://bento.me/facutom" class="dev-link" target="_blank" rel="noopener noreferrer">Facu Tom</a>
</footer>

        <nav class="bottom-nav">
            <button class="nav-item active" onclick="setTab('carnes', this)">
                <i class="fa-solid fa-drumstick-bite"></i> Carnes
            </button>
            <button class="nav-item" onclick="setTab('verdu', this)">
                <i class="fa-solid fa-carrot"></i> Verdu
            </button>
            <button class="nav-item" onclick="setTab('varios', this)">
                <i class="fa-solid fa-layer-group"></i> Varios
            </button>
            <button class="nav-item" onclick="setTab('favs', this)">
                <i class="fa-solid fa-star"></i> Favoritos
            </button>
        </nav>
    </div>

    <script>
        /* --- CONEXI√ìN SUPABASE --- */
        const SUPABASE_URL = 'https://uginrayldvkhgodvfhta.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVnaW5yYXlsZHZraGdvZHZmaHRhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwODEzMzcsImV4cCI6MjA4MTY1NzMzN30.hRp7YjVymPnsqbwh8dJjfgKFg77cdd0A5o-ETWYgeiw';
        
        const GROUPS = {
            'carnes': ['Carnes'],
            'verdu': ['Verdu'],
            'varios': ['Varios']
        };

        const STORES = [
            { id: 0, name: "COTO", color: "#ff3b30", home: "https://www.cotodigital.com.ar/sitios/cdigi/nuevositio" },      
            { id: 1, name: "CARREFOUR", color: "#2962ff", home: "https://www.carrefour.com.ar" }, 
            { id: 2, name: "DIA", color: "#ff3b30", home: "https://diaonline.supermercadosdia.com.ar" },       
            { id: 3, name: "JUMBO", color: "#00c853", home: "https://www.jumbo.com.ar" }      
        ];

        let DB = {}, flatList = [], favorites = JSON.parse(localStorage.getItem('fav_tickers')) || [], currentTab = 'carnes';
        let currentTrendFilter = null; 

        async function init() {
            try {
                /* CAMBIO: Leer de Supabase */
                const res = await fetch(`${SUPABASE_URL}/rest/v1/productos?select=*`, {
                    headers: { "apikey": SUPABASE_KEY, "Authorization": `Bearer ${SUPABASE_KEY}` }
                });
                const rows = await res.json();
                
                flatList = rows.map(row => ({
                    id: row.id,
                    n: row.nombre,
                    cat: row.categoria,
                    ticker: generateTicker(row.nombre),
                    p: [row.p_coto || 0, row.p_carrefour || 0, row.p_dia || 0, row.p_jumbo || 0],
                    h: [row.h_coto || 0, row.h_carrefour || 0, row.h_dia || 0, row.h_jumbo || 0],
                    u: [row.u_coto, row.u_carrefour, row.u_dia, row.u_jumbo]
                }));
                
                if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
                updateThemeIcon();
                document.getElementById('loader').style.display = 'none';
                renderView();
            } catch (e) {
                console.error(e);
                document.getElementById('loader').innerText = "ERROR DE CONEXI√ìN";
            }
        }

        function setTrendFilter(type) {
            currentTrendFilter = (currentTrendFilter === type) ? null : type;
            document.getElementById('btnUp').classList.toggle('active-up', currentTrendFilter === 'up');
            document.getElementById('btnDown').classList.toggle('active-down', currentTrendFilter === 'down');
            renderView();
        }

        function renderView() {
            const container = document.getElementById('tickerList');
            const term = document.getElementById('searchInput').value.toUpperCase();
            container.innerHTML = '';
            
            let dataToShow = flatList.filter(i => currentTab === 'favs' ? favorites.includes(i.id) : (GROUPS[currentTab] || []).includes(i.cat));
            if (term) dataToShow = dataToShow.filter(i => i.n.toUpperCase().includes(term) || i.ticker.includes(term));
            if (currentTrendFilter) {
                dataToShow = dataToShow.filter(item => {
                    const stats = getStats(item.p, item.h);
                    return currentTrendFilter === 'up' ? stats.isUp : stats.isDown;
                });
            }

            dataToShow.forEach(item => {
                const stats = getStats(item.p, item.h);
                if (stats.min === 0) return; 
                const isFav = favorites.includes(item.id);
                const card = document.createElement('div');
                card.innerHTML = `
                    <div class="ticker-card">
                        <div class="ticker-info" onclick="toggleDetail('${item.id}')">
                            <div class="t-left">
                                <span class="t-symbol">${item.ticker}</span>
                                <span class="t-name">${item.n}</span>
                            </div>
                            <div class="t-right">
                                <span class="t-price">$${format(stats.min)}</span><br>
                                <span class="t-change ${stats.trendClass}">${stats.icon} ${stats.spread}%</span>
                            </div>
                        </div>
                        <div class="fav-btn ${isFav?'active':''}" onclick="toggleFav('${item.id}', this)"><i class="${isFav?'fa-solid':'fa-regular'} fa-star"></i></div>
                    </div>
                    <div id="detail-${item.id}" class="order-book">
                        <div class="ob-selector">
                            <button class="sel-btn active" id="btn-m-${item.id}" onclick="switchDetailTab('${item.id}', 'market')">Market</button>
                            <button class="sel-btn" id="btn-g-${item.id}" onclick="switchDetailTab('${item.id}', 'graph')">Gr√°fico</button>
                        </div>
                        <div id="m-content-${item.id}" class="market-content active">
                            <div class="ob-header"><span>Market</span><span>Precio</span></div>
                            ${renderOrderBook(item.p, item.u, stats.min)}
                        </div>
                        <div id="g-content-${item.id}" class="ob-graph-container">
                            <canvas id="canvas-${item.id}"></canvas>
                            <div class="time-filters">
                                <button class="time-btn active" onclick="updateChartRange('${item.id}', '${item.n}', 7, this)">7D</button>
                                <button class="time-btn" onclick="updateChartRange('${item.id}', '${item.n}', 15, this)">15D</button>
                                <button class="time-btn" onclick="updateChartRange('${item.id}', '${item.n}', 30, this)">1M</button>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        async function switchDetailTab(id, type) {
            const m = document.getElementById(`m-content-${id}`);
            const g = document.getElementById(`g-content-${id}`);
            const btnM = document.getElementById(`btn-m-${id}`);
            const btnG = document.getElementById(`btn-g-${id}`);
            
            if(type === 'market') {
                m.style.display = 'block'; g.classList.remove('active');
                btnM.classList.add('active'); btnG.classList.remove('active');
            } else {
                m.style.display = 'none'; g.classList.add('active');
                btnM.classList.remove('active'); btnG.classList.add('active');
                const item = flatList.find(i => i.id == id);
                renderChart(id, item.n, 7);
            }
        }

        async function renderChart(id, nombre, dias) {
            const res = await fetch(`${SUPABASE_URL}/rest/v1/historial_precios?nombre_producto=eq.${nombre}&order=fecha.asc`, {
                headers: { "apikey": SUPABASE_KEY, "Authorization": `Bearer ${SUPABASE_KEY}` }
            });
            const data = await res.json();
            const filtered = data.slice(-dias);
            
            const ctx = document.getElementById(`canvas-${id}`).getContext('2d');
            if(window[`chart_${id}`]) window[`chart_${id}`].destroy();
            
            window[`chart_${id}`] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: filtered.map(d => d.fecha.split('-').reverse().slice(0,2).join('/')),
                    datasets: [{
                        data: filtered.map(d => d.precio_minimo),
                        borderColor: '#2962ff',
                        backgroundColor: 'rgba(41, 98, 255, 0.1)',
                        fill: true, tension: 0.3, pointRadius: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: {display: false}, tooltip: { callbacks: { label: (c) => `$${c.raw} (${filtered[c.dataIndex].supermercado})` } } },
                    scales: { y: { ticks: { font: { family: 'Roboto Mono', size: 10 } } }, x: { ticks: { font: { size: 10 } } } }
                }
            });
        }

        function updateChartRange(id, nombre, dias, btn) {
            btn.parentElement.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderChart(id, nombre, dias);
        }

        function renderOrderBook(prices, links, best) {
            let html = '';
            STORES.forEach((store, i) => {
                const p = prices[i];
                let targetUrl = (links && links[i] && links[i].startsWith("http")) ? links[i] : store.home;
                if (i === 0) targetUrl = store.home;
                let val = p > 0 ? `$${format(p)}` : "SIN PRECIO";
                let styleClass = `price-link ${p === 0 ? 'no-price' : (p === best ? 'best-val' : '')}`;
                html += `
                    <div class="ob-row">
                        <div class="ob-store"><div class="dot" style="background:${p>0?store.color:'#444'}"></div>${store.name}</div>
                        <a ${p>0?`href="${targetUrl}" target="_blank"`:''} class="${styleClass}">
                            ${val} ${p > 0 ? '<i class="fa-solid fa-arrow-up-right-from-square"></i>' : ''}
                        </a>
                    </div>`;
            });
            return html;
        }

        function getStats(pToday, pYesterday) {
            const valid = pToday.filter(p => p > 0);
            if (valid.length === 0) return { min: 0 };
            const minToday = Math.min(...valid);
            const idx = pToday.indexOf(minToday);
            const old = pYesterday[idx] || 0;
            let diff = 0, trendClass = "trend-neutral", icon = "-", isUp = false, isDown = false;
            if (old > 0) {
                diff = ((minToday - old) / old) * 100;
                if (diff > 0.1) { trendClass = "trend-up"; icon = "‚ñ≤"; isUp = true; }
                else if (diff < -0.1) { trendClass = "trend-down"; icon = "‚ñº"; isDown = true; }
            }
            return { min: minToday, spread: Math.abs(diff).toFixed(1), trendClass, icon, isUp, isDown };
        }

        function toggleFav(id, btn) {
            favorites = favorites.includes(id) ? favorites.filter(f => f !== id) : [...favorites, id];
            localStorage.setItem('fav_tickers', JSON.stringify(favorites));
            renderView();
        }

        function setTab(tabName, btn) {
            currentTab = tabName;
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderView();
        }

        function toggleDetail(id) {
            const el = document.getElementById(`detail-${id}`);
            document.querySelectorAll('.order-book.open').forEach(ob => { if (ob.id !== `detail-${id}`) ob.classList.remove('open'); });
            el.classList.toggle('open');
        }

        function toggleTheme() { 
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            updateThemeIcon();
        }

        function updateThemeIcon() {
            document.getElementById('themeIcon').className = document.body.classList.contains('dark-mode') ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
        }

        function generateTicker(name) {
            const clean = name.toUpperCase().replace(/DE|EL|LA|CON|SIN|KG|GRS|ML|\W/g, " ");
            const parts = clean.split(" ").filter(w => w.length > 2);
            return parts.length >= 2 ? (parts[0].substring(0,2) + parts[1].substring(0,2)) : clean.substring(0, 4);
        }
        function format(num) { return new Intl.NumberFormat('es-AR', { maximumFractionDigits: 0 }).format(num); }
        
        document.getElementById('searchInput').addEventListener('keyup', renderView);
        init();
    </script>
</body>
</html>
